While it's not required, ideally, you should have a general understanding of OSI Model [Layer 2](https://en.wikipedia.org/wiki/Data_link_layer) (L2) [network switches](https://en.wikipedia.org/wiki/Network_switch) work, what a [MAC table](https://en.wikipedia.org/wiki/MAC_table) is, what the Address Resolution Protocol ([ARP](https://en.wikipedia.org/wiki/Address_Resolution_Protocol)) does, and how to use Wireshark at a basic level. If you're not comfortable with these topics, please check out the [Network](https://tryhackme.com/module/network-fundamentals) and [Linux](https://tryhackme.com/module/linux-fundamentals) Fundamentals modules and [Wireshark](https://tryhackme.com/room/wireshark) room. ^00a9fa


> **“L2”** means **Layer 2**  
> This refers to the **Data Link Layer** of the OSI model. At this layer, devices communicate using **MAC addresses** (hardware addresses).

### MAC Flooding

==DEF-MAC Flooding is an attack where an attacker floods a network switch with a large number of fake MAC addresses.==

**Why it works:**  
A switch uses a **MAC address table (CAM table)** to remember which MAC addresses are reachable on which physical ports. When the table is full, the switch can’t keep track anymore.

**Result:**  
The switch acts like a hub — it sends all traffic to all ports. This allows the attacker to **sniff network traffic** that wasn’t meant for them.


### ARP Spoofing

ARP stands for **Address Resolution Protocol**. It maps IP addresses to MAC addresses inside a local network.

==DEF-ARP Spoofing (or ARP Poisoning) is a network attack where an attacker sends **forged ARP (Address Resolution Protocol) messages** onto a local area network (LAN) to **associate their MAC address with the IP address of another device**, like the default gateway or another host.==

**How the attack works:**  
An attacker sends fake ARP messages on the network. For example, they can say: _“Hey everyone, the gateway’s IP address is actually my MAC address!”_  
Devices believe it — so they send their traffic to the attacker instead of the real router.

**Result:**  
The attacker performs a **Man-in-the-Middle (MITM)** attack. They can:
- Read network traffic
- Modify it
- Steal credentials, cookies, etc.


### How they work together

In practice:
- **MAC Flooding** is used to make the switch forward all packets to all ports.
- **ARP Spoofing** poisons the network’s IP-MAC relationships so traffic is rerouted through the attacker’s machine.

Both techniques help attackers sniff or manipulate network data inside a **local network** (like a LAN).

---

## Initial Access

_For the sake of this room, let's assume the following:_

While conducting a pentest, you have gained initial access to a network and escalated privileges to root on a Linux machine. During your routine OS enumeration, you realize it's a [dual-homed](https://en.wikipedia.org/wiki/Dual-homed) host, meaning it is connected to two (or more) networks. Being the curious hacker you are, you decided to explore this network to see if you can move laterally.

After having established **persistence**, you can access the compromised host via **SSH**:

| **User** | **Password** | **IP**       | **Port** |
| -------- | ------------ | ------------ | -------- |
| admin    | Layer2       | 10.10.244.13 | 22       |

`ssh -o StrictHostKeyChecking=accept-new admin@10.10.244.13`

Note: The **admin** user is in the **sudo** group. I suggest using the **root** user to complete this room: `sudo su -`

### Questions

##### Now, can you (re)gain access? (Yay/Nay)

![[Pasted image 20250709192004.png]]
![[Pasted image 20250709192258.png]]



---

---

---

---

---


---

## References

https://tryhackme.com/room/layer2